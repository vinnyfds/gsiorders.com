---
description: 
globs: 
alwaysApply: true
---
# ðŸ§ª **MANDATORY TESTING PROGRESSION RULES**


---

## **ðŸš« TASK PROGRESSION BLOCKING RULES**

### **MANDATORY: No Next Task Until Tests Pass**

```typescript
/**
 * CURSOR AI RULE: NEVER proceed to next task until ALL tests pass
 */

const taskProgressionGate = {
  // HARD STOP: These must pass before next task
  mandatoryChecks: [
    'ðŸ§ª All unit tests pass (100%)',
    'ðŸ”— Integration tests pass (if applicable)', 
    'â™¿ Accessibility tests pass (WCAG AA)',
    'ðŸ“± Responsive tests pass (3 breakpoints)',
    'ðŸŽ¨ Visual regression tests pass',
    'âš¡ Performance benchmarks met'
  ],

  // BLOCKING RULE: If ANY test fails
  onTestFailure: {
    action: 'STOP_DEVELOPMENT',
    requirement: 'FIX_ALL_FAILING_TESTS_FIRST',
    documentation: 'DOCUMENT_ROOT_CAUSE_AND_SOLUTION',
    nextStep: 'RERUN_FULL_TEST_SUITE'
  },

  // ONLY proceed when:
  proceedConditions: [
    'âœ… All tests green/passing',
    'âœ… Code coverage meets threshold',
    'âœ… No console errors in browser',
    'âœ… No TypeScript errors',
    'âœ… Manual testing completed'
  ]
};
```

---

## **ðŸ”¬ MICRO/NANO TASK TESTING REQUIREMENTS**

### **Every Small Task Testing Pattern**

```typescript
// MICRO TASK (30min - 2hrs): Quick validation required
const microTaskTesting = {
  beforeNext: [
    'ðŸ” Unit test added/updated',
    'ðŸ–¥ï¸ Manual browser test completed',
    'ðŸ“‹ Function works as specified',
    'ðŸš¨ No new console errors',
    'ðŸ“ Test results documented'
  ],
  
  testingTime: '10-15 minutes',
  passCriteria: 'Feature works + no regressions',
  
  example: `
    // MICRO TASK: Add loading state to button
    // TESTS REQUIRED:
    test('button shows spinner when loading', () => {
      render(<Button loading={true} />);
      expect(screen.getByTestId('spinner')).toBeInTheDocument();
    });
    
    // MANUAL TEST:
    âœ… Click button â†’ spinner appears
    âœ… Loading completes â†’ spinner disappears  
    âœ… No console errors
    âœ… Responsive on mobile
  `
};

// NANO TASK (<30min): Minimal validation required  
const nanoTaskTesting = {
  beforeNext: [
    'ðŸ‘€ Visual inspection completed',
    'ðŸ”§ Function works as expected',
    'ðŸš¨ No breaking changes introduced'
  ],
  
  testingTime: '2-5 minutes',
  passCriteria: 'Change works + no obvious breaks',
  
  example: `
    // NANO TASK: Change button color to blue
    // TESTS REQUIRED:
    âœ… Button appears blue visually
    âœ… Hover state still works
    âœ… No CSS conflicts introduced
  `
};
```

---

## **ðŸ“Š MACRO TASK COMPREHENSIVE TESTING**

### **Full Feature Testing Requirements**

```typescript
/**
 * MACRO TASK (Goal level): Comprehensive testing required
 * Examples: "Complete Cart System", "Full Checkout Flow", "Admin Dashboard"
 */

const macroTaskTesting = {
  // COMPREHENSIVE TEST SUITE REQUIRED:
  fullTestSuite: [
    'ðŸ§ª Unit Tests (95%+ coverage)',
    'ðŸ”— Integration Tests (all API calls)',
    'ðŸŒ End-to-End Tests (full user flow)',
    'â™¿ Accessibility Audit (automated + manual)',
    'ðŸ“± Cross-Device Testing (mobile/tablet/desktop)',
    'ðŸŒ Cross-Browser Testing (Chrome/Firefox/Safari)',
    'âš¡ Performance Testing (Core Web Vitals)',
    'ðŸ”’ Security Testing (auth, validation, XSS)',
    'ðŸŽ¨ Visual Regression Testing (screenshot comparison)',
    'ðŸ’¾ Data Integrity Testing (database operations)'
  ],

  testingTime: '4-8 hours for full macro task',
  passCriteria: 'ALL tests pass + user acceptance criteria met',
  
  blockingRequirements: [
    'No failing tests allowed',
    'Performance benchmarks met',
    'Accessibility compliance verified',
    'Cross-browser compatibility confirmed',
    'Security vulnerabilities addressed'
  ]
};
```

### **Macro Task Test Categories**

```typescript
// GOAL 1: Infrastructure Testing (Macro)
const infrastructureMacroTesting = {
  testCategories: [
    {
      category: 'Database Integrity',
      tests: [
        'All tables created correctly',
        'Foreign key relationships work',
        'RLS policies prevent unauthorized access',
        'Indexes improve query performance',
        'Data migrations work forward/backward'
      ]
    },
    {
      category: 'API Functionality', 
      tests: [
        'All endpoints respond correctly',
        'Authentication works across all APIs',
        'Error handling consistent',
        'Rate limiting prevents abuse',
        'Input validation prevents injection'
      ]
    },
    {
      category: 'Environment Setup',
      tests: [
        'All environment variables loaded',
        'External services connect (Stripe, Supabase)',
        'Development/staging/production configs work',
        'CI/CD pipeline executes successfully'
      ]
    }
  ]
};

// GOAL 2: Frontend Components Testing (Macro)
const frontendMacroTesting = {
  testCategories: [
    {
      category: 'Component Functionality',
      tests: [
        'All props render correctly',
        'Event handlers trigger appropriate actions',
        'State management works consistently',
        'Error boundaries catch component errors',
        'Loading states provide feedback'
      ]
    },
    {
      category: 'User Experience',
      tests: [
        'Navigation flows work intuitively', 
        'Form validation provides clear feedback',
        'Search and filtering work accurately',
        'Cart operations persist across sessions',
        'Brand theming applies consistently'
      ]
    },
    {
      category: 'Visual Design',
      tests: [
        'Responsive design works on all devices',
        'Brand colors apply correctly',
        'Typography scales appropriately',
        'Images load and display properly',
        'Animations perform smoothly'
      ]
    }
  ]
};

// GOAL 3: Backend Integration Testing (Macro)
const backendMacroTesting = {
  testCategories: [
    {
      category: 'Data Operations',
      tests: [
        'CRUD operations work for all entities',
        'Complex queries return accurate results',
        'Transactions maintain data consistency',
        'Bulk operations handle large datasets',
        'Caching improves performance'
      ]
    },
    {
      category: 'External Integrations',
      tests: [
        'Stripe payments process correctly',
        'Webhook events update database',
        'Email notifications send successfully',
        'File uploads store securely',
        'Search functionality returns relevant results'
      ]
    },
    {
      category: 'Security & Performance',
      tests: [
        'Authentication prevents unauthorized access',
        'Input sanitization prevents attacks',
        'API responses meet performance targets',
        'Database queries execute efficiently',
        'Error handling doesn\'t leak sensitive data'
      ]
    }
  ]
};
```

---

## **ðŸ“‹ TESTING CHECKPOINT DOCUMENTATION**

### **Required Test Result Documentation**

```typescript
/**
 * CURSOR AI MUST document test results before proceeding
 */

const testDocumentationTemplate = `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ§ª TESTING CHECKPOINT: [Task Name]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ“… DATE: [Current Date/Time]
ðŸŽ¯ TASK: [Specific task from implementation plan]
â±ï¸ TESTING TIME: [Time spent testing]

UNIT TESTS:
âœ… [Test 1 name] - PASSED
âœ… [Test 2 name] - PASSED  
âŒ [Test 3 name] - FAILED: [Reason + fix applied]

INTEGRATION TESTS:
âœ… [Integration 1] - PASSED
âœ… [Integration 2] - PASSED

MANUAL TESTS:
âœ… Mobile responsive (375px) - PASSED
âœ… Tablet responsive (768px) - PASSED
âœ… Desktop responsive (1024px+) - PASSED
âœ… Chrome browser - PASSED
âœ… Firefox browser - PASSED

ACCESSIBILITY TESTS:
âœ… Screen reader compatible - PASSED
âœ… Keyboard navigation - PASSED
âœ… Color contrast WCAG AA - PASSED

PERFORMANCE TESTS:
âœ… Page load < 2s - PASSED
âœ… API response < 500ms - PASSED

ðŸ” ISSUES FOUND & RESOLVED:
- Issue 1: [Description] â†’ Fixed by [Solution]
- Issue 2: [Description] â†’ Fixed by [Solution]

ðŸš¦ OVERALL STATUS: âœ… PASSED - SAFE TO PROCEED
ðŸš¦ NEXT TASK: [Next task name from implementation plan]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`;
```

---

## **ðŸ”„ TESTING AUTOMATION RULES**

### **Automated Test Execution**

```typescript
const automatedTestingRules = {
  // RUN automatically before next task:
  automatedChecks: [
    'npm run test:unit',        // All unit tests
    'npm run test:integration', // Integration tests
    'npm run lint',            // Code quality
    'npm run type-check',      // TypeScript validation
    'npm run build',           // Build succeeds
    'npm run test:e2e'         // End-to-end (for macro tasks)
  ],

  // BLOCKING: If any command fails
  onAutomatedFailure: {
    action: 'HALT_DEVELOPMENT',
    requirement: 'FIX_ALL_ISSUES_FIRST',
    retestRequired: true,
    documentFailures: true
  },

  // Script for testing checkpoint:
  testingScript: `
    #!/bin/bash
    echo "ðŸ§ª Running testing checkpoint..."
    
    # Unit tests
    npm run test:unit || exit 1
    echo "âœ… Unit tests passed"
    
    # Integration tests  
    npm run test:integration || exit 1
    echo "âœ… Integration tests passed"
    
    # Build check
    npm run build || exit 1
    echo "âœ… Build successful"
    
    # Type checking
    npm run type-check || exit 1
    echo "âœ… TypeScript validation passed"
    
    echo "ðŸŽ‰ All automated tests passed! Safe to proceed."
  `
};
```

### **Manual Testing Checklist**

```typescript
const manualTestingChecklist = {
  // REQUIRED for every UI task:
  uiTesting: [
    'ðŸ‘† Click all interactive elements',
    'âŒ¨ï¸ Test keyboard navigation',
    'ðŸ“± Test on actual mobile device',
    'ðŸ–¥ï¸ Test on actual desktop',
    'ðŸ”„ Test loading states',
    'âŒ Test error states',
    'ðŸŽ¨ Verify brand theming works',
    'â™¿ Test with screen reader'
  ],

  // REQUIRED for every API task:
  apiTesting: [
    'ðŸ“¨ Test with valid inputs',
    'âš ï¸ Test with invalid inputs',
    'ðŸ”’ Test authentication required',
    'ðŸ’¾ Verify database changes',
    'ðŸ“Š Check response format',
    'â±ï¸ Measure response time',
    'ðŸš« Test error scenarios'
  ],

  // DOCUMENTATION: Record results
  recordResults: 'Document all manual test results in testing checkpoint'
};
```

---

## **ðŸŽ¯ MACRO TASK ACCEPTANCE CRITERIA**

### **User Acceptance Testing Requirements**

```typescript
const macroTaskAcceptanceCriteria = {
  // GOAL 1: Complete Cart System
  cartSystemAcceptance: {
    userStories: [
      'âœ… User can add products to cart',
      'âœ… User can view cart contents', 
      'âœ… User can update quantities',
      'âœ… User can remove items',
      'âœ… Cart persists across sessions',
      'âœ… Cart shows accurate totals',
      'âœ… Cart works on all devices'
    ],
    technicalRequirements: [
      'âœ… All cart API endpoints work',
      'âœ… Database operations are atomic',
      'âœ… Error handling is comprehensive',
      'âœ… Performance meets benchmarks',
      'âœ… Security prevents manipulation'
    ]
  },

  // GOAL 2: Complete Checkout Flow
  checkoutFlowAcceptance: {
    userStories: [
      'âœ… User can initiate checkout',
      'âœ… User redirected to Stripe',
      'âœ… Payment processes successfully',
      'âœ… Order created in database',
      'âœ… Inventory updated correctly',
      'âœ… User sees confirmation',
      'âœ… Email notification sent'
    ],
    technicalRequirements: [
      'âœ… Stripe integration secure',
      'âœ… Webhook handles all events',
      'âœ… Database transactions atomic',
      'âœ… Error recovery robust',
      'âœ… Idempotency prevents duplicates'
    ]
  }
};
```

---

## **ðŸš¨ TESTING FAILURE PROTOCOLS**

### **When Tests Fail**

```typescript
const testFailureProtocol = {
  // IMMEDIATE actions when ANY test fails:
  immediateActions: [
    'ðŸ›‘ STOP current development',
    'ðŸ“ Document the failure details',
    'ðŸ” Analyze root cause',
    'ðŸ”§ Implement fix',
    'ðŸ§ª Rerun ALL affected tests',
    'âœ… Verify fix doesn\'t break anything else'
  ],

  // NEVER do this when tests fail:
  prohibitedActions: [
    'âŒ Continue to next task',
    'âŒ Skip the failing test',
    'âŒ Comment out the test',
    'âŒ Lower test expectations',
    'âŒ Ignore accessibility failures',
    'âŒ Defer performance fixes'
  ],

  // Root cause analysis template:
  rootCauseTemplate: `
    TESTING FAILURE ANALYSIS:
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    ðŸ“… FAILURE DATE: [Date/Time]
    ðŸ§ª FAILED TEST: [Test name]
    ðŸ“ FAILURE MESSAGE: [Error message]
    
    ðŸ” ROOT CAUSE:
    [Detailed analysis of why test failed]
    
    ðŸ”§ SOLUTION APPLIED:
    [Specific changes made to fix]
    
    ðŸ§ª VERIFICATION:
    [How the fix was tested]
    
    ðŸ›¡ï¸ PREVENTION:
    [Changes to prevent similar failures]
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  `
};
```

---

**âœ… COMPREHENSIVE TESTING PROGRESSION RULES:**
- [x] **No next task until ALL tests pass** (blocking rule)
- [x] **Micro task testing requirements** (10-15 min validation)
- [x] **Nano task testing requirements** (2-5 min validation)
- [x] **Macro task comprehensive testing** (4-8 hour full suite)
- [x] **Automated testing checkpoints** (scripts that must pass)
- [x] **Manual testing checklists** (UI/API validation)
- [x] **Test result documentation** (required before proceeding)
- [x] **Failure protocols** (what to do when tests fail)
- [x] **User acceptance criteria** (macro task completion)

**ðŸŽ¯ Cursor AI will now NEVER proceed without complete testing validation at every level!**


